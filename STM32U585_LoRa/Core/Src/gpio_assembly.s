/*
 * gpio_assembly.s
 *
 *  Created on: Jul 7, 2025
 *      Author: peter
 */

.syntax unified
.cpu cortex-m33
.fpu softvfp
.thumb

.text


.global GPIOA_MODER_Set_Alt_Function
.global GPIOA_AFRH_Set_Alt_Function
.global GPIOA_OSPEEDR_Set

.global GPIOE_MODER_Set_Alt_Function
.global GPIOE_AFRH_Set_Alt_Function
.global GPIOE_OSPEEDR_Set
.global GPIOE_PUPDR_Set
.global GPIOE_PUPDR_MOSI_UP
.global GPIOE_PUPDR_MOSI_DOWN
.global GPIOE_PUPDR_MISO_UP
.global GPIOE_PUPDR_MISO_DOWN
.global GPIOE_PUPDR_SCK_UP
.global GPIOE_PUPDR_SCK_DOWN
.global GPIOE_PUPDR_NSS_UP
.global GPIOE_PUPDR_NSS_DOWN
# PORT C
.global GPIOC_MODER_Output
.global GPIOC_OTYPER_PP
.global GPIOC_OSPEEDR
.global GPIOC_BSRR_SET
.global GPIOC_BSRR_RESET
.global GPIOC_PUPDR_NUND
.global GPIOC_PUPDR_RDY_UP
.global GPIOC_PUPDR_RDY_DOWN



// Define global variables

.equ GPIOA_BASE_ADDR, 		0x42020000U
.equ GPIOB_BASE_ADDR, 		0x42020400U
.equ GPIOC_BASE_ADDR, 		0x42020800U
.equ GPIOD_BASE_ADDR, 		0x42020C00U
.equ GPIOE_BASE_ADDR,		0x42021000U
.equ GPIOF_BASE_ADDR,		0x42021400U
.equ GPIOG_BASE_ADDR,		0x42021800U
.equ GPIOH_BASE_ADDR,		0x42021C00U
.equ GPIOI_BASE_ADDR,		0x42022000U

.equ GPIOx_MODER_OFFSET,	0x00U
.equ GPIOx_OTYPER_OFFSET, 	0x04U
.equ GPIOx_OSPEEDR_OFFSET,  0x08U
.equ GPIOx_PUPDR_OFFSET, 	0x0CU
.equ GPIOx_IDR_OFFSET,		0x10U
.equ GPIOx_ODR_OFFSET,		0x14U
.equ GPIOx_BSRR_OFFSET,		0x18U
.equ GPIOx_AFRL_OFFSET,		0x20U
.equ GPIOx_AFRH_OFFSET,		0x24U

# GPIO PORT E
#AF5
#PE12-SPI1_NSS
#PE13-SPI1_SCK
#PE14-SPI1_MISO
#PE15-SPI1_MOSI

GPIOE_MODER_Set_Alt_Function:
	//PE11 PE12, PE13, PE14, PE15
	//MODER bits = 10: Alternate function mode
	LDR		R1, =GPIOE_BASE_ADDR
	LDR		R2, =GPIOx_MODER_OFFSET
	ADDS	R1,	R2
	LDR		R0, [R1]
	MOVS	R2, 0x3
	LSLS	R3, R2, #24	//PE12
	MVNS	R3,	R3
	ANDS	R0, R3		//clear bits
	MOVS	R2, 0x2
	LSLS	R3, R2, #24
	ORRS	R0, R3
	MOVS	R2, 0x3
	LSLS	R3, R2, #26	//PE13
	MVNS	R3,	R3
	ANDS	R0, R3		//clear bits
	MOVS	R2, 0x2
	LSLS	R3, R2, #26
	ORRS	R0, R3
	MOVS	R2, 0x3
	LSLS	R3, R2, #28	//PE14
	MVNS	R3,	R3
	ANDS	R0, R3		//clear bits
	MOVS	R2, 0x2
	LSLS	R3, R2, #28
	ORRS	R0, R3
	MOVS	R2, 0x3
	LSLS	R3, R2, #30	//PE15
	MVNS	R3,	R3
	ANDS	R0, R3		//clear bits
	MOVS	R2, 0x2
	LSLS	R3, R2, #30
	ORRS	R0, R3
	STR		R0,	[R1]
	BX LR


#AF5
#PE12-SPI1_NSS
#PE13-SPI1_SCK
#PE14-SPI1_MISO
#PE15-SPI1_MOSI

GPIOE_AFRH_Set_Alt_Function:
	//0101: AF5 16,20,24,28
	LDR		R1, =GPIOE_BASE_ADDR
	LDR		R2, =GPIOx_AFRH_OFFSET
	ADDS	R1,	R2
	LDR		R0, [R1]
	#16
	MOVS	R2, 0xF
	LSLS	R2, #16
	MVNS	R2,	R2
	ANDS	R0, R2
	MOVS	R2, 0x5
	LSLS	R2, #16
	ORRS	R0, R2
	#20
	MOVS	R2, 0xF
	LSLS	R2, #20
	MVNS	R2,	R2
	ANDS	R0, R2
	MOVS	R2, 0x5
	LSLS	R2, #20
	ORRS	R0, R2
	#24
	MOVS	R2, 0xF
	LSLS	R2, #24
	MVNS	R2,	R2
	ANDS	R0, R2
	MOVS	R2, 0x5
	LSLS	R2, #24
	ORRS	R0, R2
	#28
	MOVS	R2, 0xF
	LSLS	R2, #28
	MVNS	R2,	R2
	ANDS	R0, R2
	MOVS	R2, 0x5
	LSLS	R2, #28
	ORRS	R0, R2
	STR		R0,	[R1]
	BX LR

GPIOE_OSPEEDR_Set:
	LDR		R1, =GPIOE_BASE_ADDR
	LDR		R2, =GPIOx_OSPEEDR_OFFSET
	ADDS	R1,	R2
	LDR		R0, [R1]
	MOVS	R2, 0x3 //11 high-speed
//	LSLS	R3, R2, #24  //do not set ospeedr for NSS on slave
//	ORRS	R0, R3
//	LSLS	R3, R2, #26  //do not set ospeedr for SCK on slave
//	ORRS	R0, R3
	LSLS	R3, R2, #28
	ORRS	R0, R3
//	LSLS	R3, R2, #30  //do not set ospeedr for MOSI on slave
//	ORRS	R0, R3
	STR		R0,	[R1]
	BX LR

#PE12-SPI1_NSS
#PE13-SPI1_SCK
#PE14-SPI1_MISO
#PE15-SPI1_MOSI
//00: No pull-up, pull-down
//01: Pull-up
//10: Pull-down
GPIOE_PUPDR_Set:
	LDR		R1, =GPIOE_BASE_ADDR
	LDR		R2, =GPIOx_PUPDR_OFFSET
	ADDS	R1,	R2
	LDR		R0, [R1]
	MOVS	R2, 0x2 //10: Pull-down
	LSLS	R3, R2, #24 //NSS
	ORRS	R0, R3
	MOVS	R2, 0x3 //00: Pull-down
	LSLS	R3, R2, #26 //SCK
	MVNS	R3, R3
	ANDS	R0, R3
	LSLS	R3, R2, #28 //MISO
	MVNS	R3, R3
	ANDS	R0, R3
	LSLS	R3, R2, #30 //MOSI
	MVNS	R3, R3
	ANDS	R0, R3
	STR		R0,	[R1]
	BX LR

GPIOE_PUPDR_NSS_DOWN:
	LDR		R1, =GPIOE_BASE_ADDR
	LDR		R2, =GPIOx_PUPDR_OFFSET
	ADDS	R1,	R2
	LDR		R0, [R1]
	MOVS	R2, 0x2
	LSLS	R3, R2, #24 //NSS
	ORRS	R0, R3
	STR		R0,	[R1]
	BX LR

GPIOE_PUPDR_NSS_UP:
	LDR		R1, =GPIOE_BASE_ADDR
	LDR		R2, =GPIOx_PUPDR_OFFSET
	ADDS	R1,	R2
	LDR		R0, [R1]
	MOVS	R2, 0x1
	LSLS	R3, R2, #24 //NSS
	ORRS	R0, R3
	STR		R0,	[R1]
	BX LR

GPIOE_PUPDR_SCK_DOWN:
	LDR		R1, =GPIOE_BASE_ADDR
	LDR		R2, =GPIOx_PUPDR_OFFSET
	ADDS	R1,	R2
	LDR		R0, [R1]
	MOVS	R2, 0x2
	LSLS	R3, R2, #26 //SCK
	ORRS	R0, R3
	STR		R0,	[R1]
	BX LR

GPIOE_PUPDR_SCK_UP:
	LDR		R1, =GPIOE_BASE_ADDR
	LDR		R2, =GPIOx_PUPDR_OFFSET
	ADDS	R1,	R2
	LDR		R0, [R1]
	MOVS	R2, 0x1
	LSLS	R3, R2, #26 //SCK
	ORRS	R0, R3
	STR		R0,	[R1]
	BX LR

GPIOE_PUPDR_MISO_DOWN:
	LDR		R1, =GPIOE_BASE_ADDR
	LDR		R2, =GPIOx_PUPDR_OFFSET
	ADDS	R1,	R2
	LDR		R0, [R1]
	MOVS	R2, 0x2
	LSLS	R3, R2, #28 //MISO
	ORRS	R0, R3
	STR		R0,	[R1]
	BX LR

GPIOE_PUPDR_MISO_UP:
	LDR		R1, =GPIOE_BASE_ADDR
	LDR		R2, =GPIOx_PUPDR_OFFSET
	ADDS	R1,	R2
	LDR		R0, [R1]
	MOVS	R2, 0x1
	LSLS	R3, R2, #28 //MISO
	ORRS	R0, R3
	STR		R0,	[R1]
	BX LR

GPIOE_PUPDR_MOSI_DOWN:
	LDR		R1, =GPIOE_BASE_ADDR
	LDR		R2, =GPIOx_PUPDR_OFFSET
	ADDS	R1,	R2
	LDR		R0, [R1]
	MOVS	R2, 0x2
	LSLS	R3, R2, #30 //MOSI
	ORRS	R0, R3
	STR		R0,	[R1]
	BX LR

GPIOE_PUPDR_MOSI_UP:
	LDR		R1, =GPIOE_BASE_ADDR
	LDR		R2, =GPIOx_PUPDR_OFFSET
	ADDS	R1,	R2
	LDR		R0, [R1]
	MOVS	R2, 0x1
	LSLS	R3, R2, #30 //MOSI
	ORRS	R0, R3
	STR		R0,	[R1]
	BX LR


// GPIO C PORT
// PC1-SPI1_RDY  PC1

GPIOC_MODER_Output:
	//01   MODE1
	LDR		R1, =GPIOC_BASE_ADDR
	LDR		R2, =GPIOx_MODER_OFFSET
	ADDS	R1, R2
	LDR		R0, [R1]
	MOVS	R3, 0x3
	LSLS	R3, #2
	MVNS	R3, R3
	ANDS 	R0, R3  	//clear bits
	MOVS	R3, 0x01	//01 General purpose output mode
	LSLS	R3, #2
	ORRS	R0, R3
	STR		R0, [R1]
	BX LR

GPIOC_OTYPER_PP:
	//0	 Outupt push-pull
	LDR		R1, =GPIOC_BASE_ADDR
	LDR		R2, =GPIOx_OTYPER_OFFSET
	ADDS	R1, R2
	LDR		R0, [R1]
	MOVS	R3, 0x1
	LSLS	R3, #1
	MVNS	R3, R3
	ANDS	R0, R3
	STR		R0, [R1]
	BX LR

GPIOC_OSPEEDR:
	//00 LOW SPEED
	LDR		R1, =GPIOC_BASE_ADDR
	LDR		R2, =GPIOx_OSPEEDR_OFFSET
	ADDS	R1, R2
	LDR		R0, [R1]
	MOVS	R3, 0x3
	LSLS	R3, #2
	MVNS	R3, R3
	ANDS 	R0, R3  	//clear bits
	STR		R0, [R1]
	BX LR

GPIOC_PUPDR_NUND:
//00: No pull-up, pull-down
	LDR		R1, =GPIOC_BASE_ADDR
	LDR		R2, =GPIOx_PUPDR_OFFSET
	ADDS	R1,	R2
	LDR		R0, [R1]
	MOVS	R2, 0x3
	LSLS	R3, R2, #2
	MVNS	R3, R3
	ANDS	R0, R3  //claer bits
	STR		R0,	[R1]
	BX LR

GPIOC_PUPDR_RDY_UP:
	LDR		R1, =GPIOC_BASE_ADDR
	LDR		R2, =GPIOx_PUPDR_OFFSET
	ADDS	R1,	R2
	LDR		R0, [R1]
	MOVS	R2, 0x1
	LSLS	R3, R2, #2
	ORRS	R0, R3
	STR		R0,	[R1]
	BX LR

GPIOC_PUPDR_RDY_DOWN:
	LDR		R1, =GPIOC_BASE_ADDR
	LDR		R2, =GPIOx_PUPDR_OFFSET
	ADDS	R1,	R2
	LDR		R0, [R1]
	MOVS	R2, 0x2
	LSLS	R3, R2, #2
	ORRS	R0, R3
	STR		R0,	[R1]
	BX LR

GPIOC_BSRR_SET:
	LDR		R1, =GPIOC_BASE_ADDR
	LDR		R2, =GPIOx_BSRR_OFFSET
	ADDS	R1,	R2
	LDR		R0, [R1]
	MOVS	R2, 0x1
	LSLS	R3, R2, #1
	ORRS	R0, R3
	STR		R0,	[R1]
	BX LR

GPIOC_BSRR_RESET:
	LDR		R1, =GPIOC_BASE_ADDR
	LDR		R2, =GPIOx_BSRR_OFFSET
	ADDS	R1,	R2
	LDR		R0, [R1]
	MOVS	R2, 0x1
	LSLS	R3, R2, #17
	ORRS	R0, R3
	STR		R0,	[R1]
	BX LR


// GPIO A PORT

GPIOA_MODER_Set_Alt_Function:
	// Pin PA8 for MCO clock interrupt
	//MODER bits = 10: Alternate function mode
	LDR		R1, =GPIOA_BASE_ADDR
	LDR		R2, =GPIOx_MODER_OFFSET
	ADDS	R1,	R2
	LDR		R0, [R1]
	MOVS	R2, 0x3
	LSLS	R3, R2, #16 //PA8
	MVNS	R3,	R3
	ANDS	R0, R3	//clear bits
	MOVS	R2, 0x2
	LSLS	R3, R2, #16
	ORRS	R0, R3
	STR		R0,	[R1]
	BX LR

/************************************************

AF0 (MCO): PA8 on CN13

***********************************************/
GPIOA_AFRH_Set_Alt_Function:
	//AF0 (MCO): PA8
	//0000: AF0
	LDR		R1, =GPIOE_BASE_ADDR
	LDR		R2, =GPIOx_AFRH_OFFSET
	ADDS	R1,	R2
	LDR		R0, [R1]
	#PA8
	MOVS	R2, 0xF
	MVNS	R2,	R2
	ANDS	R0, R2  //clear bits
	STR		R0,	[R1]
	BX LR

GPIOA_OSPEEDR_Set:
	LDR		R1, =GPIOA_BASE_ADDR
	LDR		R2, =GPIOx_OSPEEDR_OFFSET
	ADDS	R1,	R2
	LDR		R0, [R1]
	MOVS	R2, 0x3 //11 high-speed
	LSLS	R3, R2, #16
	ORRS	R0, R3
	STR		R0,	[R1]
	BX LR




